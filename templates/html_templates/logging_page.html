<!DOCTYPE html>
<html>
<head>
    <title>System Metrics History</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        .warning {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>System Metrics History</h1>
    <table>
        <tr>
            <th>Timestamp</th>
            <th>CPU Utilization (%)</th>
            <th>Memory Utilization (%)</th>
            <th>Status</th>
        </tr>
        {% for metric in metrics %}
        <tr>
            <td>{{ metric.timestamp }}</td>
            <td>{{ "%.1f"|format(metric.cpu_percent) }}</td>
            <td>{{ "%.1f"|format(metric.mem_percent) }}</td>
            <td {% if metric.cpu_percent > 80 or metric.mem_percent > 80 %}class="warning"{% endif %}>
                {% if metric.cpu_percent > 80 or metric.mem_percent > 80 %}
                    WARNING: High Utilization
                {% else %}
                    Normal
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </table>
</body>
</html>

<!--
To use this updated version:

1. First, install Redis and the Python Redis client:
```bash
# Install Redis server
sudo apt-get install redis-server  # For Ubuntu/Debian
# or
brew install redis  # For macOS

# Install Python Redis client
pip install redis
```

2. Start the Redis server:
```bash
redis-server
```

3. The application now provides:
   - Original monitoring at the root URL "/"
   - Metrics history at "/metrics"
   - Background thread logging metrics to Redis every 5 seconds
   - Storage of the last 100 measurements

4. You can also directly query Redis using the redis-cli:
```bash
redis-cli
> LRANGE system_metrics 0 -1  # Get all metrics
```

Key features of this implementation:
1. Uses a background thread to continuously log metrics
2. Stores metrics as JSON strings in a Redis list
3. Maintains a fixed-size history (100 entries) to prevent unlimited growth
4. Provides a web interface to view the metrics history
5. Includes warning indicators for high utilization
6. Error handling for Redis operations

You can customize this further by:
1. Adjusting the logging interval (currently 5 seconds)
2. Modifying the number of historical entries kept (currently 100)
3. Adding more metrics to track
4. Enhancing the metrics visualization (e.g., adding graphs)
5. Adding data export capabilities

Would you like me to explain any part in more detail or help you customize any of these features?
-->